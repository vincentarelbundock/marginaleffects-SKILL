# Causal inference with G-computation

Explains the parametric g-formula workflow for estimating causal effects from observational data. Starts by defining potential outcomes `Y_i^1`, `Y_i^0`, treatment indicator `D_i`, and the estimands ATE `E[Y^1 - Y^0]`, ATT `E[Y^1 - Y^0 | D=1]`, and ATU `E[Y^1 - Y^0 | D=0]`. It spells out the assumptions required for identification: conditional exchangeability (no unmeasured confounding after conditioning on covariates `Z` or treatment intensity `L`), positivity (non-zero probability of each treatment), consistency (well-defined treatment), and non-interference (no spillovers). ATT/ATU require weaker forms of positivity/exchangeability.

Implementation steps using the Imbens-Rubin-Sacerdote lottery study:
1. **Model**: fit an outcome regression that conditions on confounders (e.g., `lm(earnings_post_avg ~ win_big * (tickets + demographics + pre-earnings))`). Interactions allow heterogeneous effects and improve precision.
2. **Impute**: create counterfactual datasets by toggling `win_big` to 0 or 1 for every respondent (`transform(dat, win_big = 0/1)`), then call `predictions(mod, newdata = d0/d1)` to impute `\hat Y_i^0` and `\hat Y_i^1`.
3. **Compare**: obtain estimands via `comparisons()`/`avg_comparisons()` on the stacked predictions, computing differences for each unit and averaging to get the ATE. Restricting to treated units yields ATT; to controls yields ATU.

The chapter shows how the same code structure recovers G-computation estimands in other settings: specify `variables=` to set treatment shifts, pass `newdata=` containing poststratification cells, and request uncertainty via delta method or bootstrap. It draws parallels to inverse probability weighting (IPW) and doubly-robust estimators, explaining that g-computation models the outcome; IPW models the treatment assignment; combining them yields double robustness. Functions to know: `predictions()`, `comparisons()`, `avg_comparisons()`, `datagrid()` for imputation grids, and `hypotheses()` to test if ATE differs from zero or if ATT â‰  ATU.
